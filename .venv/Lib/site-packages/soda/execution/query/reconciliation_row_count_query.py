from soda.execution.query.query import Query


class ReconciliationRowCountQuery(Query):
    def __init__(
        self, data_source_scan: "DataSourceScan", metric: "ReconciliationRowDiffMetric", partition: "Partition"
    ):
        super().__init__(
            data_source_scan=data_source_scan,
            unqualified_query_name=f"reconciliation_row_diff",
            sql=metric.query,
            partition=partition,
        )
        self.metric = metric

    def execute(self):
        self.fetchone()
        if self.row:
            self.metric.set_value(self.row[0])
